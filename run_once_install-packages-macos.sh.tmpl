#!/usr/bin/env bash

set -euo pipefail

{{- if eq .chezmoi.os "darwin" }}
# Install essential packages via Homebrew on macOS
# This script runs once during initial setup

if ! command -v brew &>/dev/null; then
  echo "Error: Homebrew not found. Please install it first."
  exit 1
fi

# Ensure gum is installed first for nicer UX in subsequent scripts
if ! command -v gum &>/dev/null; then
  echo "Installing gum (via Homebrew) ..."
  brew install gum
fi

# Minimal, elegant message
if command -v gum &>/dev/null; then
  gum style --foreground 213 --bold "➜ Installing essential Homebrew packages"
else
  echo "Installing essential Homebrew packages..."
fi

# Essential CLI tools
brew install \
  fish \
  starship \
  git \
  gh \
  neovim \
  tmux \
  fzf \
  ripgrep \
  fd \
  bat \
  eza \
  zoxide \
  delta \
  curl \
  wget \
  tree \
  htop \
  jq \
  gum \
  atuin

# Development tools
brew install \
  node \
  uv \
  jjui

# Essential GUI apps (Homebrew casks)
if command -v gum &>/dev/null; then
  gum style --foreground 213 --bold "➜ Installing essential Homebrew casks (GUI apps)"
else
  echo "Installing essential Homebrew casks (GUI apps)..."
fi

brew install --cask \
  wezterm \
  raycast || true

if command -v gum &>/dev/null; then
  gum style --foreground 82 "✓ Essential packages installed"
else
  echo "Essential packages installed successfully"
fi
{{- end }}
