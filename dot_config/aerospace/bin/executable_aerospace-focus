#!/usr/bin/env bash
set -euo pipefail

usage() {
  echo "usage: aerospace-focus <left|right|up|down>" >&2
  exit 2
}

if [[ $# -ne 1 ]]; then
  usage
fi

direction=$(printf '%s' "$1" | tr '[:upper:]' '[:lower:]')
case "$direction" in
  left|right|up|down) ;;
  *)
    echo "aerospace-focus: unsupported direction '$1'" >&2
    usage
    ;;
esac

resolve_cli() {
  local candidate
  if [[ -n "${AEROSPACE_CLI:-}" ]]; then
    candidate=${AEROSPACE_CLI}
    if command -v "$candidate" >/dev/null 2>&1; then
      command -v "$candidate"
      return 0
    fi
    if [[ -x "$candidate" ]]; then
      printf '%s' "$candidate"
      return 0
    fi
  fi

  for candidate in aerospace /opt/homebrew/bin/aerospace /usr/local/bin/aerospace; do
    if command -v "$candidate" >/dev/null 2>&1; then
      command -v "$candidate"
      return 0
    fi
    if [[ -x "$candidate" ]]; then
      printf '%s' "$candidate"
      return 0
    fi
  done

  return 1
}

if ! cli=$(resolve_cli); then
  echo "aerospace-focus: could not locate AeroSpace CLI" >&2
  exit 1
fi

if ! "$cli" focus --boundaries all-monitors-outer-frame "$direction"; then
  echo "aerospace-focus: focus command failed for direction '$direction'" >&2
  exit 1
fi
