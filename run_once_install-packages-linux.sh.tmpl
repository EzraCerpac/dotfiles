#!/usr/bin/env bash

set -euo pipefail

{{- if eq .chezmoi.os "linux" }}
# Install essential packages on Linux
# This script runs once during initial setup

# Detect Linux distribution
if [ -f /etc/os-release ]; then
    . /etc/os-release
    DISTRO="$ID"
else
    echo "Cannot detect Linux distribution"
    exit 1
fi

echo "Installing packages for $DISTRO..."

case "$DISTRO" in
    ubuntu|debian)
        # Update package lists
        sudo apt-get update -qq
        
        # Essential packages
        sudo apt-get install -y \
            build-essential \
            curl \
            wget \
            git \
            unzip \
            software-properties-common \
            apt-transport-https \
            ca-certificates \
            gnupg \
            lsb-release \
            fish \
            neovim \
            tmux \
            fzf \
            ripgrep \
            fd-find \
            bat \
            tree \
            htop \
            jq \
            python3 \
            python3-pip \
            nodejs \
            npm
        ;;
    fedora|rhel|centos)
        sudo dnf update -y
        sudo dnf install -y \
            gcc \
            gcc-c++ \
            make \
            curl \
            wget \
            git \
            unzip \
            fish \
            neovim \
            tmux \
            fzf \
            ripgrep \
            fd-find \
            bat \
            tree \
            htop \
            jq \
            python3 \
            python3-pip \
            nodejs \
            npm
        ;;
    *)
        echo "Unsupported distribution: $DISTRO"
        echo "Please install packages manually"
        ;;
esac

echo "Essential packages installed successfully"
{{- end }}