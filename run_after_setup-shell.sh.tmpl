#!/usr/bin/env bash

set -euo pipefail

# Setup shell after applying configurations

echo "Setting up shell configuration..."

export PATH="${HOME}/.local/bin:${PATH}"

# Add fish to /etc/shells if missing
if command -v fish &>/dev/null; then
    FISH_PATH="$(which fish)"
    if ! grep -qF "$FISH_PATH" /etc/shells 2>/dev/null; then
        echo "Adding fish to /etc/shells (requires sudo)..."
        echo "$FISH_PATH" | sudo tee -a /etc/shells >/dev/null 2>&1 || \
            echo "Could not add fish to /etc/shells. Run: echo $FISH_PATH | sudo tee -a /etc/shells"
    fi
fi

# Suggest chsh if fish is not the default shell
if command -v fish &>/dev/null && [[ "$SHELL" != *"fish"* ]]; then
    echo "Fish shell detected. To make it your default shell, run:"
    echo "  chsh -s $(which fish)"
fi

# Hint about mise activation
if command -v mise &>/dev/null; then
    echo "mise is installed. Tools managed via ~/.config/mise/config.toml"
fi

echo "Shell setup complete"

cat << 'EOF'

Dotfiles setup complete
Next: restart terminal | chezmoi doctor | chezmoi update

EOF
